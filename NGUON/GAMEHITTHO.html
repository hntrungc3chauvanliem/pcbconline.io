<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Trò chơi hít thở thư giãn — Bong bóng bay</title>
  <style>
    :root{
      --bg:#f0f9ff;
      --card:#ffffffcc;
      --accent:#22c55e;
      --glass: rgba(255,255,255,0.4);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:'Poppins', system-ui, sans-serif;color:#0f172a;background:linear-gradient(180deg,#a5f3fc 0%, #fef3c7 100%);}

    .app{min-height:100vh;display:grid;place-items:center;padding:24px;}

    .panel{width:100%;max-width:980px;background:var(--card);backdrop-filter: blur(10px);border-radius:20px;box-shadow:0 10px 30px rgba(0,0,0,0.15);overflow:hidden;display:grid;grid-template-columns:1fr 420px;gap:20px;padding:28px;}

    .left{position:relative;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg, rgba(255,255,255,0.4), rgba(255,255,255,0.2));border-radius:16px;padding:20px}

    .circle-wrap{position:relative;width:360px;height:360px;display:grid;place-items:center}
    .breath-circle{width:120px;height:120px;border-radius:50%;background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.6), rgba(34,197,94,0.4));display:grid;place-items:center;transition:all 1s cubic-bezier(.2,.9,.3,1);box-shadow:0 10px 30px rgba(34,197,94,0.3);}
    .breath-circle.expanded{width:280px;height:280px;transition:all 1s cubic-bezier(.2,.9,.3,1)}
    .breath-label{position:absolute;bottom:18px;color:#0f172a;font-weight:600}

    .bubbles{position:absolute;inset:10px;pointer-events:none;overflow:hidden;border-radius:12px;}
    .bubble{position:absolute;bottom:-60px;border-radius:50%;opacity:0.9;transform:translateY(0) scale(1);animation:floatUp linear forwards;box-shadow:0 6px 10px rgba(0,0,0,0.2);}

    @keyframes floatUp{to{transform:translateY(-140vh) scale(1.2);opacity:0}}

    .right{display:flex;flex-direction:column;gap:18px}
    h1{margin:0;font-size:22px;color:#0f172a}
    p.lead{margin:6px 0 0;color:#334155}

    .controls{background:var(--glass);padding:16px;border-radius:10px}
    .row{display:flex;gap:10px;align-items:center}
    .btn{appearance:none;border:0;padding:10px 14px;border-radius:10px;background:linear-gradient(180deg,#34d399,#22c55e);color:#fff;font-weight:700;cursor:pointer;box-shadow:0 6px 18px rgba(34,197,94,0.4)}
    .btn.ghost{background:transparent;color:#047857;border:1px solid #047857}
    .range{width:100%}
    .select{padding:8px;border-radius:8px;background:transparent;border:1px solid #047857;color:#065f46}

    .info{font-size:13px;color:#334155}

    @media (max-width:880px){
      .panel{grid-template-columns:1fr;padding:18px}
      .right{order:2}
      .left{order:1}
      .circle-wrap{width:300px;height:300px}
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="panel" role="application" aria-label="Trò chơi hít thở thư giãn">
      <div class="left">
        <div class="circle-wrap" aria-hidden="false">
          <div id="bubbles" class="bubbles"></div>
          <div id="breath" class="breath-circle">
            <div style="text-align:center;color:#065f46;font-weight:800;font-size:18px;">Thở</div>
          </div>
          <div id="breathLabel" class="breath-label">Sẵn sàng</div>
        </div>
      </div>

      <div class="right">
        <div>
          <h1>Thở thư giãn — Bong bóng bay</h1>
          <p class="lead">Hít thở chậm rãi cùng những bong bóng đầy màu sắc để xua tan mệt mỏi và tìm lại niềm vui.</p>
        </div>

        <div class="controls" role="region" aria-label="Điều khiển">
          <div class="row" style="justify-content:space-between">
            <div style="display:flex;gap:10px;align-items:center">
              <button id="startBtn" class="btn">Bắt đầu</button>
              <button id="stopBtn" class="btn ghost">Dừng</button>
            </div>
            <div class="info">Trạng thái: <span id="state">Dừng</span></div>
          </div>

          <hr style="border:none;height:8px;opacity:0.05;margin:12px 0">

          <div style="display:flex;gap:10px;align-items:center;">
            <label for="pattern">Chu kỳ hít/thở:</label>
            <select id="pattern" class="select" aria-label="Chọn chu kỳ">
              <option value="4-4">Hít 4s — Thở 4s</option>
              <option value="4-2-6">Hít 4s — Giữ 2s — Thở 6s</option>
              <option value="5-5">Hít 5s — Thở 5s</option>
              <option value="6-4-8">Hít 6s — Giữ 4s — Thở 8s</option>
            </select>
          </div>

          <div style="margin-top:8px;">
            <label for="bpm">Số bong bóng tạo mỗi hút:</label>
            <input id="bpm" class="range" type="range" min="1" max="12" value="6" />
            <div style="display:flex;justify-content:space-between;font-size:13px;color:#334155"><span>1</span><span id="bpmVal">6</span><span>12</span></div>
          </div>

          <div style="margin-top:8px;display:flex;gap:8px;align-items:center;">
            <label for="size">Kích thước bong bóng:</label>
            <input id="size" type="range" min="20" max="120" value="60" class="range" />
          </div>

          <div style="margin-top:12px;font-size:13px;color:#334155">
            Mẹo: Hít bằng mũi, thở ra bằng miệng, giữ tâm trí nhẹ nhàng và vui vẻ.
          </div>
        </div>

        <div style="display:flex;gap:10px;align-items:center;justify-content:space-between">
          <div class="info">Phát triển bởi bạn — Chỉnh sửa thoải mái.</div>
          <div style="font-size:12px;color:#065f46">Giao diện sáng, thân thiện và tươi vui</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const breath = document.getElementById('breath');
    const breathLabel = document.getElementById('breathLabel');
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const stateText = document.getElementById('state');
    const bubblesEl = document.getElementById('bubbles');
    const patternSel = document.getElementById('pattern');
    const bpmRange = document.getElementById('bpm');
    const bpmVal = document.getElementById('bpmVal');
    const sizeRange = document.getElementById('size');

    let running=false;

    function parsePattern(str){return str.split('-').map(n=>Number(n));}
    function setState(s){stateText.textContent=s;}

    const COLORS=['#f87171','#fb923c','#facc15','#4ade80','#22d3ee','#60a5fa','#a78bfa','#f472b6'];
    function spawnBubble(size){
      const b=document.createElement('div');b.className='bubble';
      const color=COLORS[Math.floor(Math.random()*COLORS.length)];
      const left=Math.random()*90+2;const w=size+(Math.random()*size*0.6-size*0.3);
      b.style.width=w+'px';b.style.height=w+'px';b.style.left=left+'%';
      b.style.background=`radial-gradient(circle at 30% 30%, rgba(255,255,255,0.5), ${color})`;
      b.style.animationDuration=(6+Math.random()*5)+'s';bubblesEl.appendChild(b);
      setTimeout(()=>{if(b&&b.parentNode)b.parentNode.removeChild(b);},12000);
    }

    async function startBreathing(){
      if(running)return;running=true;setState('Đang chạy');startBtn.disabled=true;stopBtn.disabled=false;
      const pattern=parsePattern(patternSel.value);
      while(running){
        const inhale=pattern[0];breathLabel.textContent='Hít vào';breath.classList.add('expanded');
        const count=Number(bpmRange.value);const sizeBase=Number(sizeRange.value);
        const interval=inhale*1000/Math.max(1,count);
        for(let i=0;i<count&&running;i++){spawnBubble(sizeBase);await sleep(interval);} if(!running)break;
        if(pattern.length===3){breathLabel.textContent='Giữ';await sleep(pattern[1]*1000);}
        const exhale=pattern.length===3?pattern[2]:pattern[1];breathLabel.textContent='Thở ra';breath.classList.remove('expanded');await sleep(exhale*1000);
        breathLabel.textContent='Chuẩn bị';await sleep(300);
      }
      setState('Dừng');startBtn.disabled=false;stopBtn.disabled=true;breathLabel.textContent='Dừng';breath.classList.remove('expanded');
    }

    function stopBreathing(){running=false;}
    function sleep(ms){return new Promise(r=>setTimeout(r,ms));}

    startBtn.addEventListener('click',()=>startBreathing());
    stopBtn.addEventListener('click',()=>stopBreathing());
    bpmRange.addEventListener('input',()=>bpmVal.textContent=bpmRange.value);

    document.addEventListener('keydown',(e)=>{if(e.code==='Space'){if(!running)startBreathing();else stopBreathing();e.preventDefault();}});

    stopBtn.disabled=true;bpmVal.textContent=bpmRange.value;setState('Sẵn sàng');
  </script>
</body>
</html>